import React, { ErrorInfo, ReactNode } from 'react';
import { SvgXml } from 'react-native-svg';
import Box from '../box';
import Button from '../button';
import Text from '../text';
export default class ErrorBlock extends React.Component<
  { customNode?: ReactNode; onError?: (error: Error, errorInfo: ErrorInfo) => void },
  { error: Error | null }
> {
  state = {
    error: null,
  };

  static getDerivedStateFromError(error: Error) {
    return { error };
  }

  componentDidCatch(error: Error, info: ErrorInfo) {
    // 错误上报
    if (this.props.onError) {
      this.props.onError(error, info);
    } else {
      console.error(error, info);
    }
  }

  onRefresh = () => {
    this.setState({ error: null });
  };

  renderFallback = () => {
    if (this.props.customNode) return this.props.customNode;

    return <Fallback onRefresh={this.onRefresh} />;
  };

  render() {
    if (this.state.error) {
      return this.renderFallback();
    }
    return this.props.children;
  }
}

function Fallback({ onRefresh }: { onRefresh: () => void }) {
  const xml = `
    <svg width="190" height="190" viewBox="0 0 190 190" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g clip-path="url(#clip0_732_1686)">
      <g clip-path="url(#clip1_732_1686)">
      <path d="M64.5904 77.5247V76.7148H57.5842V77.6553H56.0452V99.7025H66.2696V77.5247H64.5904ZM65.3837 97.1755H56.8242V96.5224H65.3837V97.1755ZM65.3837 94.164H56.8242V93.5109H65.3837V94.164ZM65.3837 91.1525H56.8242V90.4994H65.3837V91.1525ZM65.3837 88.2217H56.8242V87.5686H65.3837V88.2217ZM65.3837 85.2981H56.8242V84.645H65.3837V85.2981ZM65.3837 82.2866H56.8242V81.6335H65.3837V82.2866ZM65.3837 79.3558H56.8242V78.7027H65.3837V79.3558Z" fill="url(#paint0_linear_732_1686)"/>
      <path d="M50.8178 89.8295V64.1368H43.0397V62.061H39.7479V74.7269H38.8621V113.475H52.7582V89.8295H50.8178ZM45.0014 97.3844H43.0397V95.482H45.0014V97.3844ZM45.0014 94.4085H43.0397V92.5061H45.0014V94.4085ZM45.0014 91.4469H43.0397V89.5445H45.0014V91.4469ZM45.0014 88.4924H43.0397V86.59H45.0014V88.4924ZM45.0014 85.5165H43.0397V83.6141H45.0014V85.5165ZM45.0014 79.579H43.0397V77.6767H45.0014V79.579ZM45.0014 76.6032H43.0397V74.7008H45.0014V76.6032ZM45.0014 73.6392H43.0397V71.7368H45.0014V73.6392ZM45.0014 70.6847H43.0397V68.7823H45.0014V70.6847ZM45.0014 67.7088H43.0397V65.8064H45.0014V67.7088ZM47.9346 97.3844H45.9728V95.482H47.9346V97.3844ZM47.9346 94.4085H45.9728V92.5061H47.9346V94.4085ZM47.9346 91.4469H45.9728V89.5445H47.9346V91.4469ZM47.9346 88.4924H45.9728V86.59H47.9346V88.4924ZM47.9346 85.5165H45.9728V83.6141H47.9346V85.5165ZM47.9346 79.579H45.9728V77.6767H47.9346V79.579ZM47.9346 76.6032H45.9728V74.7008H47.9346V76.6032ZM47.9346 73.6392H45.9728V71.7368H47.9346V73.6392ZM47.9346 70.6847H45.9728V68.7823H47.9346V70.6847ZM47.9346 67.7088H45.9728V65.8064H47.9346V67.7088Z" fill="url(#paint1_linear_732_1686)"/>
      <path d="M127.366 103.338C127.452 102.234 127.366 66.1743 127.366 66.1743H131.767V74.1804H138.774V90.9123H142.747V103.338H127.366Z" fill="url(#paint2_linear_732_1686)"/>
      <path d="M156.156 87.1551V86.0032H154.969V75.9498H152.071V74.8336H150.117V73.1924H149.098V68.4092H148.364V73.2257H147.428V74.8668H144.531V77.5553H142.856V108.722H156.959V87.1527H156.156V87.1551ZM145.348 99.6903H144.393V96.0708H145.348V99.6903ZM145.348 95.2609H144.393V91.6414H145.348V95.2609ZM145.348 90.8316H144.393V87.2121H145.348V90.8316ZM145.348 86.3238H144.393V82.7043H145.348V86.3238ZM145.348 81.8137H144.393V78.1942H145.348V81.8137ZM147.314 99.6903H146.359V96.0708H147.314V99.6903ZM147.314 95.2609H146.359V91.6414H147.314V95.2609ZM147.314 90.8316H146.359V87.2121H147.314V90.8316ZM147.314 86.3238H146.359V82.7043H147.314V86.3238ZM147.314 81.8137H146.359V78.1942H147.314V81.8137ZM149.278 99.6903H148.323V96.0708H149.278V99.6903ZM149.278 95.2609H148.323V91.6414H149.278V95.2609ZM149.278 90.8316H148.323V87.2121H149.278V90.8316ZM149.278 86.3238H148.323V82.7043H149.278V86.3238ZM149.278 81.8137H148.323V78.1942H149.278V81.8137ZM151.245 99.6903H150.29V96.0708H151.245V99.6903ZM151.245 95.2609H150.29V91.6414H151.245V95.2609ZM151.245 90.8316H150.29V87.2121H151.245V90.8316ZM151.245 86.3238H150.29V82.7043H151.245V86.3238ZM151.245 81.8137H150.29V78.1942H151.245V81.8137ZM153.211 99.6903H152.256V96.0708H153.211V99.6903ZM153.211 95.2609H152.256V91.6414H153.211V95.2609ZM153.211 90.8316H152.256V87.2121H153.211V90.8316ZM153.211 86.3238H152.256V82.7043H153.211V86.3238ZM153.211 81.8137H152.256V78.1942H153.211V81.8137Z" fill="url(#paint3_linear_732_1686)"/>
      <path d="M22.7644 118.717V97.4511H25.2012V86.5973L33.5754 82.9707V97.2801H35.4113V118.717H22.7644Z" fill="url(#paint4_linear_732_1686)"/>
      <path d="M166.397 114.774H159.049V85.5308L166.397 89.0861V114.774Z" fill="url(#paint5_linear_732_1686)"/>
      <path d="M21.534 44.2816C21.534 44.2816 23.7522 38.2301 29.2052 40.6051C30.464 39.3274 32.022 38.3987 34.1286 38.8167C36.2352 39.2371 37.5937 40.8141 38.0545 41.8639C38.7147 41.833 44.0015 42.0087 44.0015 47.4926C44.0015 52.9765 37.6032 52.872 37.1401 52.4374C36.5701 52.9456 33.8293 55.703 30.5043 52.5561C29.7847 53.1712 27.4335 55.7766 23.7166 52.1809C21.9947 52.9005 17.9026 53.4539 17.1093 49.2287C16.3161 45.006 20.3845 43.8114 21.534 44.2816Z" fill="url(#paint6_linear_732_1686)"/>
      <path d="M144.338 35.537C144.338 35.537 146.556 29.4855 152.009 31.8605C153.268 30.5827 154.826 29.6541 156.933 30.0721C159.039 30.4901 160.398 32.0695 160.859 33.1192C161.519 33.0884 166.806 33.2641 166.806 38.748C166.806 44.2319 160.407 44.125 159.944 43.6903C159.374 44.1986 156.634 46.956 153.309 43.8091C152.589 44.4242 150.238 47.0296 146.521 43.4338C144.799 44.1535 140.707 44.7069 139.914 40.4817C139.12 36.2614 143.189 35.0667 144.338 35.537Z" fill="url(#paint7_linear_732_1686)"/>
      <path d="M115.995 48.4854C115.995 48.4854 117.6 44.1035 121.548 45.8254C122.46 44.8992 123.585 44.227 125.112 44.531C126.637 44.835 127.62 45.9774 127.953 46.735C128.43 46.7137 132.259 46.8395 132.259 50.8082C132.259 54.7768 127.628 54.7008 127.293 54.3873C126.879 54.7554 124.896 56.7504 122.488 54.4752C121.968 54.9193 120.265 56.8074 117.577 54.2044C116.33 54.7245 113.368 55.1259 112.793 52.0669C112.216 49.0103 115.164 48.1458 115.995 48.4854Z" fill="url(#paint8_linear_732_1686)"/>
      <path d="M95.4654 177.989C144.126 177.989 183.573 159.268 183.573 136.175C183.573 113.082 144.126 94.3608 95.4654 94.3608C46.8048 94.3608 7.35767 113.082 7.35767 136.175C7.35767 159.268 46.8048 177.989 95.4654 177.989Z" fill="url(#paint9_linear_732_1686)"/>
      <path d="M35.1262 131.062C35.1262 131.062 34.2878 132.252 35.6891 134.023C36.9383 135.6 38.9119 135.294 39.5674 134.788C39.7693 136.161 41.4532 139.054 44.1179 137.417C46.6236 135.881 45.4171 133.544 44.6167 132.625C46.1818 132.183 47.3479 128.433 43.7569 127.138C44.2889 125.59 44.3839 124.889 43.6049 123.497C42.8544 122.158 41.6218 121.944 39.6553 122.759L36.8124 123.958L35.0003 120.576L34.0313 121.137L36.1213 124.367L33.3521 125.756C33.3521 125.756 30.9842 126.682 32.0054 129.224C32.9507 131.577 35.1262 131.062 35.1262 131.062Z" fill="url(#paint10_linear_732_1686)"/>
      <path d="M30.3073 116.641H38.8716C38.8716 116.641 41.6385 116.719 42.1895 113.558C42.7951 110.088 40.2704 109.611 40.2704 109.611C40.2704 109.611 41.7905 108.913 41.4603 106.288C41.1278 103.666 38.8193 103.334 37.8574 103.455C38.0142 101.899 38.3419 98.3772 34.6844 98.3416C31.1528 98.3059 31.1742 101.861 31.4378 103.263C30.1791 103.277 26.3767 105.165 29.0509 109.307C27.5951 110.554 26.9799 111.273 27.0441 113.071C27.1058 114.872 28.2078 116.641 30.3073 116.641Z" fill="url(#paint11_linear_732_1686)"/>
      <path d="M38.6602 111.834L35.0075 114.237L34.9077 111.915L37.2162 109.193L34.8721 111.088L34.5681 103.987L34.3449 111.136L31.8796 109.174L34.3211 111.862L34.2475 114.254L30.4902 111.494L34.219 115.116L34.0314 121.139H35.302L35.0455 115.154L38.6602 111.834Z" fill="#C6D5E6"/>
      <path d="M159.203 126.713C159.203 126.713 158.432 127.81 159.721 129.44C160.871 130.893 162.69 130.61 163.293 130.143C163.478 131.406 165.032 134.068 167.485 132.565C169.791 131.15 168.682 128.998 167.943 128.152C169.385 127.746 170.459 124.291 167.153 123.101C167.644 121.676 167.732 121.03 167.012 119.75C166.321 118.517 165.186 118.317 163.376 119.07L160.754 120.175L159.085 117.061L158.194 117.576L160.118 120.55L157.569 121.83C157.569 121.83 155.389 122.683 156.33 125.024C157.199 127.188 159.203 126.713 159.203 126.713Z" fill="url(#paint12_linear_732_1686)"/>
      <path d="M154.762 113.434H162.647C162.647 113.434 165.196 113.508 165.701 110.596C166.257 107.402 163.934 106.963 163.934 106.963C163.934 106.963 165.336 106.319 165.029 103.904C164.723 101.488 162.597 101.182 161.711 101.296C161.856 99.8637 162.158 96.6194 158.79 96.5862C155.539 96.5529 155.558 99.8257 155.8 101.118C154.641 101.13 151.138 102.868 153.603 106.685C152.264 107.832 151.696 108.497 151.755 110.15C151.817 111.805 152.831 113.434 154.762 113.434Z" fill="url(#paint13_linear_732_1686)"/>
      <path d="M162.455 109.007L159.092 111.221L159.001 109.081L161.127 106.575L158.968 108.321L158.688 101.78L158.481 108.364L156.213 106.556L158.46 109.034L158.391 111.238L154.933 108.694L158.367 112.031L158.192 117.576H159.365L159.127 112.064L162.455 109.007Z" fill="#C6D5E6"/>
      <path d="M54.8244 105.291C54.8244 105.291 54.4088 105.88 55.1023 106.756C55.7198 107.537 56.6959 107.385 57.0213 107.134C57.121 107.813 57.9546 109.243 59.2728 108.435C60.5125 107.675 59.9164 106.519 59.5198 106.065C60.294 105.846 60.8711 103.992 59.0946 103.353C59.3583 102.588 59.4058 102.241 59.0186 101.552C58.6481 100.89 58.0378 100.783 57.0664 101.187L55.658 101.78L54.7626 100.108L54.2829 100.386L55.316 101.982L53.9456 102.669C53.9456 102.669 52.7748 103.127 53.2806 104.383C53.7485 105.547 54.8244 105.291 54.8244 105.291Z" fill="url(#paint14_linear_732_1686)"/>
      <path d="M52.4399 98.1586H56.6746C56.6746 98.1586 58.0426 98.1966 58.3157 96.6339C58.6149 94.9168 57.3657 94.6817 57.3657 94.6817C57.3657 94.6817 58.1186 94.3349 57.9547 93.0382C57.7908 91.7414 56.6484 91.5775 56.1734 91.6369C56.2518 90.8674 56.4133 89.1242 54.6036 89.1075C52.8556 89.0909 52.8674 90.8484 52.9981 91.5419C52.3758 91.549 50.4948 92.4824 51.8177 94.532C51.0981 95.1472 50.7917 95.5058 50.8249 96.394C50.8558 97.2823 51.4021 98.1586 52.4399 98.1586Z" fill="url(#paint15_linear_732_1686)"/>
      <path d="M56.5702 95.7811L54.7652 96.971L54.7153 95.8215L55.8577 94.4749L54.6987 95.413L54.5467 91.9004L54.4374 95.4344L53.2167 94.4654L54.4255 95.7954L54.3875 96.9781L52.5303 95.6125L54.3757 97.4056L54.2807 100.384H54.91L54.7842 97.4222L56.5702 95.7811Z" fill="#C6D5E6"/>
      <path d="M106.685 115.261L163.03 150.874L101.714 169.974L84.8564 115.261H106.685Z" fill="url(#paint16_linear_732_1686)"/>
      <path d="M102.042 111.986H89.4995L90.4495 103.709H101.092L102.042 111.986Z" fill="url(#paint17_linear_732_1686)"/>
      <path d="M106.685 111.986H84.8564V115.261H106.685V111.986Z" fill="url(#paint18_linear_732_1686)"/>
      <path d="M127.685 104.892H63.8566C61.1871 104.892 59.0234 102.728 59.0234 100.059V55.8527C59.0234 53.1832 61.1871 51.0195 63.8566 51.0195H127.685C130.354 51.0195 132.518 53.1832 132.518 55.8527V100.059C132.518 102.728 130.354 104.892 127.685 104.892Z" fill="url(#paint19_linear_732_1686)"/>
      <path d="M124.787 96.4317H66.7564C64.5951 96.4317 62.8447 94.6814 62.8447 92.5201V58.959C62.8447 56.7977 64.5951 55.0474 66.7564 55.0474H124.787C126.948 55.0474 128.699 56.7977 128.699 58.959V92.5225C128.696 94.6814 126.946 96.4317 124.787 96.4317Z" fill="url(#paint20_linear_732_1686)"/>
      <path d="M95.7718 103.186C96.9995 103.186 97.9948 102.191 97.9948 100.963C97.9948 99.7355 96.9995 98.7402 95.7718 98.7402C94.5441 98.7402 93.5488 99.7355 93.5488 100.963C93.5488 102.191 94.5441 103.186 95.7718 103.186Z" fill="#ECF0F7"/>
      <path d="M95.7719 63.7588C88.9913 63.7588 83.4766 69.2759 83.4766 76.0542C83.4766 82.8324 88.9937 88.3495 95.7719 88.3495C102.553 88.3495 108.067 82.8324 108.067 76.0542C108.067 69.2759 102.553 63.7588 95.7719 63.7588ZM101.885 68.2499L95.7601 74.375L89.6444 68.2594C91.3331 66.9294 93.4587 66.1338 95.7696 66.1338C98.0757 66.1338 100.199 66.927 101.885 68.2499ZM85.8492 76.0565C85.8492 73.7504 86.6424 71.6272 87.9653 69.9409L94.0786 76.0542L87.9629 82.1698C86.6424 80.4835 85.8492 78.3603 85.8492 76.0565ZM89.6444 83.8513L95.7601 77.7357L101.885 83.8608C100.199 85.186 98.0757 85.9769 95.7696 85.9769C93.4611 85.9769 91.3331 85.1813 89.6444 83.8513ZM103.567 82.1817L97.4392 76.0542L103.564 69.929C104.894 71.6177 105.69 73.7457 105.69 76.0565C105.692 78.3674 104.897 80.493 103.567 82.1817Z" fill="url(#paint21_linear_732_1686)"/>
      </g>
      </g>
      <defs>
      <linearGradient id="paint0_linear_732_1686" x1="61.1563" y1="99.7028" x2="61.1563" y2="76.7155" gradientUnits="userSpaceOnUse">
      <stop offset="5.35827e-07" stop-color="white"/>
      <stop offset="1" stop-color="#DBE3EE"/>
      </linearGradient>
      <linearGradient id="paint1_linear_732_1686" x1="45.8098" y1="113.476" x2="45.8098" y2="62.0596" gradientUnits="userSpaceOnUse">
      <stop offset="5.35827e-07" stop-color="white"/>
      <stop offset="1" stop-color="#DBE3EE"/>
      </linearGradient>
      <linearGradient id="paint2_linear_732_1686" x1="135.058" y1="103.339" x2="135.058" y2="66.1751" gradientUnits="userSpaceOnUse">
      <stop offset="5.35827e-07" stop-color="white"/>
      <stop offset="1" stop-color="#DBE3EE"/>
      </linearGradient>
      <linearGradient id="paint3_linear_732_1686" x1="149.908" y1="108.723" x2="149.908" y2="68.41" gradientUnits="userSpaceOnUse">
      <stop offset="5.35827e-07" stop-color="white"/>
      <stop offset="1" stop-color="#DBE3EE"/>
      </linearGradient>
      <linearGradient id="paint4_linear_732_1686" x1="29.0885" y1="118.717" x2="29.0885" y2="82.9705" gradientUnits="userSpaceOnUse">
      <stop offset="5.35827e-07" stop-color="white"/>
      <stop offset="1" stop-color="#EDF1F9"/>
      </linearGradient>
      <linearGradient id="paint5_linear_732_1686" x1="162.723" y1="114.773" x2="162.723" y2="85.5296" gradientUnits="userSpaceOnUse">
      <stop offset="5.35827e-07" stop-color="white"/>
      <stop offset="1" stop-color="#EDF1F9"/>
      </linearGradient>
      <linearGradient id="paint6_linear_732_1686" x1="30.5047" y1="54.0441" x2="30.5047" y2="38.7156" gradientUnits="userSpaceOnUse">
      <stop offset="0.2332" stop-color="white"/>
      <stop offset="1" stop-color="#D3DFEE"/>
      </linearGradient>
      <linearGradient id="paint7_linear_732_1686" x1="153.309" y1="45.2994" x2="153.309" y2="29.9709" gradientUnits="userSpaceOnUse">
      <stop offset="0.2332" stop-color="white"/>
      <stop offset="1" stop-color="#D3DFEE"/>
      </linearGradient>
      <linearGradient id="paint8_linear_732_1686" x1="122.488" y1="55.553" x2="122.488" y2="44.4577" gradientUnits="userSpaceOnUse">
      <stop offset="0.2332" stop-color="white"/>
      <stop offset="1" stop-color="#D3DFEE"/>
      </linearGradient>
      <linearGradient id="paint9_linear_732_1686" x1="95.4645" y1="177.99" x2="95.4645" y2="94.3595" gradientUnits="userSpaceOnUse">
      <stop offset="0.4065" stop-color="white"/>
      <stop offset="1" stop-color="#DAE4EF"/>
      </linearGradient>
      <linearGradient id="paint10_linear_732_1686" x1="45.8103" y1="136.061" x2="33.5942" y2="121.502" gradientUnits="userSpaceOnUse">
      <stop offset="0.4034" stop-color="#EFF4F8"/>
      <stop offset="1" stop-color="#D4DFEC"/>
      </linearGradient>
      <linearGradient id="paint11_linear_732_1686" x1="27.0365" y1="107.492" x2="42.2808" y2="107.492" gradientUnits="userSpaceOnUse">
      <stop offset="0.1022" stop-color="#F0F5F8"/>
      <stop offset="1" stop-color="#B4C7DC"/>
      </linearGradient>
      <linearGradient id="paint12_linear_732_1686" x1="169.04" y1="131.317" x2="157.791" y2="117.911" gradientUnits="userSpaceOnUse">
      <stop offset="0.4034" stop-color="#EFF4F8"/>
      <stop offset="1" stop-color="#D4DFEC"/>
      </linearGradient>
      <linearGradient id="paint13_linear_732_1686" x1="151.752" y1="105.009" x2="165.79" y2="105.009" gradientUnits="userSpaceOnUse">
      <stop offset="0.1022" stop-color="#F0F5F8"/>
      <stop offset="1" stop-color="#B4C7DC"/>
      </linearGradient>
      <linearGradient id="paint14_linear_732_1686" x1="60.1076" y1="107.764" x2="54.0653" y2="100.563" gradientUnits="userSpaceOnUse">
      <stop offset="1.4385e-07" stop-color="#EAEFF6"/>
      <stop offset="1" stop-color="#CDDAE9"/>
      </linearGradient>
      <linearGradient id="paint15_linear_732_1686" x1="50.8218" y1="93.6338" x2="58.3619" y2="93.6338" gradientUnits="userSpaceOnUse">
      <stop offset="0.1022" stop-color="#F0F5F8"/>
      <stop offset="1" stop-color="#B4C7DC"/>
      </linearGradient>
      <linearGradient id="paint16_linear_732_1686" x1="132.033" y1="161.281" x2="116.255" y2="106.257" gradientUnits="userSpaceOnUse">
      <stop offset="0.0938" stop-color="white"/>
      <stop offset="0.9362" stop-color="#BBCBE0"/>
      </linearGradient>
      <linearGradient id="paint17_linear_732_1686" x1="89.5001" y1="107.848" x2="102.042" y2="107.848" gradientUnits="userSpaceOnUse">
      <stop stop-color="#DDE5F0"/>
      <stop offset="1" stop-color="#9FB7CE"/>
      </linearGradient>
      <linearGradient id="paint18_linear_732_1686" x1="84.8563" y1="113.624" x2="106.686" y2="113.624" gradientUnits="userSpaceOnUse">
      <stop stop-color="#D4DEEC"/>
      <stop offset="1" stop-color="#B6C9DE"/>
      </linearGradient>
      <linearGradient id="paint19_linear_732_1686" x1="59.0242" y1="77.9562" x2="132.518" y2="77.9562" gradientUnits="userSpaceOnUse">
      <stop stop-color="#CED9E9"/>
      <stop offset="1" stop-color="#A7BFD6"/>
      </linearGradient>
      <linearGradient id="paint20_linear_732_1686" x1="128.698" y1="75.74" x2="62.8443" y2="75.74" gradientUnits="userSpaceOnUse">
      <stop stop-color="#E7ECF4"/>
      <stop offset="1" stop-color="#E4E9F3"/>
      </linearGradient>
      <linearGradient id="paint21_linear_732_1686" x1="108.067" y1="76.0559" x2="83.4749" y2="76.0559" gradientUnits="userSpaceOnUse">
      <stop stop-color="#D4DEEB"/>
      <stop offset="1" stop-color="#A7BFD6"/>
      </linearGradient>
      <clipPath id="clip0_732_1686">
      <rect width="190" height="190" fill="white"/>
      </clipPath>
      <clipPath id="clip1_732_1686">
      <rect width="190" height="190" fill="white" transform="translate(0 -5)"/>
      </clipPath>
      </defs>
    </svg>
  `;

  return (
    <Box padding="x3" justifyContent={'center'} alignItems="center">
      <SvgXml xml={xml} width={190} height={190} />
      <Text variant="p1" color="gray300" marginBottom={'x4'}>
        对不起，出错了
      </Text>
      <Button title="刷新试试" type="primary" onPress={onRefresh} width="100%" />
    </Box>
  );
}
